\documentclass[../../sets-and-functions.ftl.tex]{subfiles}

\typeout{
  \begin{forthel}
    [readtex FLib/BasicNotions/src/sets-and-functions/sections/02_functions/01_functions.ftl.tex]

    [checkconsistency off]

    Let $u,v,w$ denote elements.
    Let $x,y,z$ denote sets.
    Let $f,g,h$ denote functions.
  \end{forthel}
}

\begin{document}
  \section{Image and preimage}

  \subsection{The image}

  \begin{forthel}
    \begin{lemma}
      Let $f$ be a function.
      There exists a set $y$ such that $y = \{ f(u) \mid u \in \dom(f) \cap z \}$.
    \end{lemma}
    \begin{proof}
      Take $y = \range(f \restr (\dom(f) \cap z))$.
      Then $y = \{ (f \restr (\dom(f) \cap z))(u) \mid u \in \dom(f) \cap z \}$.
      Hence $y = \{ f(u) \mid u \in \dom(f) \cap z \}$.
    \end{proof}

    \begin{definition}
      Let $f$ be a function.
      $f[z]$ is the set $y$ such that $y = \{ f(u) \mid u \in \dom(f) \cap z \}$.
    \end{definition}

    Let the image of $z$ under $f$ stand for $f[z]$.
    Let the direct image of $z$ under $f$ stand for $f[z]$.

    \begin{proposition}[SF 02 02 549225]
      Let $f$ be a function from $x$ to $y$ and $a \subseteq x$.
      Then $f[a] = \{ f(u) \mid u \in a \}$.
    \end{proposition}
    \begin{proof}
      $f[a] = \{ f(u) \mid u \in \dom(f) \cap a \}$.
      $\dom(f) \cap a = x \cap a = a$.
      Hence the thesis.
    \end{proof}

    \begin{corollary}[SF 02 02 516307]
      Let $f$ be a function from $x$ to $y$.
      Then $f[x] = \range(f)$.
    \end{corollary}
    \begin{proof}
      We have $f[x] = \{ f(u) \mid u \in x \}$.
      Hence $f[x] = \range(f)$.
    \end{proof}

    \begin{corollary}[SF 02 0 216993]
      Let $f$ be a function from $x$ to $y$ and $a \subseteq x$.
      Then $f[a] = \range(f \restr a)$.
    \end{corollary}
    \begin{proof}
      We have $f[a] = \{ f(u) \mid u \in a \}$.
      Hence $f[a] = \range(f \restr a)$.
    \end{proof}

    \begin{proposition}[SF 02 02 560324]
      Let $a \subseteq x$.
      Then $\id{x}[a] = a$.
    \end{proposition}
    \begin{proof}
      $\id{x}[a] = \{ \id{x}(u) \mid u \in a \}$.
      We have $\id{x}(u) = u$ for all $u \in a$.
      Hence $\id{x}[a] = \{ "element" u \mid u \in a \}$.
      Thus $\id{x}[a] = a$.
    \end{proof}

    \begin{proposition}[SF 02 02 196036]
      Let $a \subseteq x$ and $v$ be an element.
      Assume that $a$ is nonempty.
      Then $\const{x}{v}[a] = \set{v}$.
    \end{proposition}
    \begin{proof}
      Let us show that $\const{x}{v}[a] \subseteq \set{v}$.
        Let $w \in \const{x}{v}[a]$.
        Take $u \in a$ such that $w = \const{x}{v}(u)$.
        Then $w = v$.
        Hence $w \in \set{v}$.
      End.

      Let us show that $\set{v} \subseteq \const{x}{v}[a]$.
        Let $w \in \set{v}$.
        Then $w = v$.
        Take $u \in a$.
        Then $\const{x}{v}(u) = v = w$.
        Hence $w \in \const{x}{v}[a]$.
      End.
    \end{proof}

    \begin{proposition}[SF 02 01 257685]
      Let $f$ be a function from $x$ into $y$ and $a \subseteq x$.
      Then $f \restr a$ is a bijection between $a$ and $f[a]$.
    \end{proposition}
    \begin{proof}
      (1) $f \restr a$ is a function of $a$.

      (2) $f \restr a$ is one to one.

      (3) $\range(f \restr a) = f[a]$.
      Proof.
        Let us show that $\range(f \restr a) \subseteq f[a]$.
          Let $v \in \range(f \restr a)$.
          Take $u \in a$ such that $v = (f \restr a)(u)$.
          Then $v = f(u)$.
          Hence $v \in f[a]$.
        End.

        Let us show that $f[a] \subseteq \range(f \restr a)$.
          Let $v \in f[a]$.
          Take $u \in a$ such that $v = f(u)$.
          Then $v = (f \restr a)(u)$.
          Hence $v \in \range(f \restr a)$.
        End.
      Qed.

      Thus $f \restr a$ is an one to one function from $a$ onto $f[a]$.
      Therefore $f \restr a$ is a bijection between $a$ and $f[a]$.
    \end{proof}
  \end{forthel}


  \subsection{The preimage}

  \begin{forthel}
    \begin{lemma}
      Let $f$ be a function.
      There exists a set $y$ such that $y = \{ u \in \dom(f) \mid f(u) \in z \}$.
    \end{lemma}
    \begin{proof}
      Case $f(u) \in z$ for all $u \in \dom(f)$. Obvious.

      Case $f(u) \notin z$ for some $u \in \dom(f)$.
        Take $w \in \dom(f)$ such that $f(w) \notin z$.
        Define $$g(u) =
          \begin{cases}
            u & f(u) \in z \\
            w & f(u) \notin z
          \end{cases}$$
        for $u \in \dom(f)$.
        $\range(g) = \{ g(u) \mid u \in \dom(f) \}$.
        Hence $\range(g) = \{ u \in \dom(f) \mid f(u) \in z "or" u = w \}$.
        Take $y = \range(g) \setminus \set{w}$.
        Then $y = \{ u \in \dom(f) \mid f(u) \in z \}$.
      End.
    \end{proof}

    \begin{definition}
      Let $f$ be a function.
      $f^{-}[z]$ is the set $y$ such that $y = \{ u \in \dom(f) \mid f(u) \in z \}$.
    \end{definition}

    Let the preimage of $z$ under $f$ stand for $f^{-}[z]$.
    Let the inverse image of $z$ under $f$ stand for $f^{-}[z]$.

    \begin{proposition}[SF 02 02 317629]
      Let $b \subseteq y$.
      Then $\id{y}^{-}[b] = b$.
    \end{proposition}
    \begin{proof}
      $\id{y}^{-}[b] = \{ u \in y \mid \id{y}(u) \in b \}$.
      $\id{y}(u) = u$ for all $u \in y$.
      Hence $\id{y}^{-}[b] = \{ u \in y \mid u \in b \}$.
      Thus $\id{y}^{-}[b] = b$.
    \end{proof}

    \begin{proposition}[SF 02 02 732231]
      Let $v$ be an element and $z$ be a set that contains $v$.
      Then $\const{x}{v}^{-}[z] = x$.
    \end{proposition}
    \begin{proof}
      $\const{x}{v}^{-}[z] = \{ u \in x \mid \const{x}{v}(u) \in z \}$.
      $\const{x}{v}(u) = v$ for every $u \in x$.
      Hence $\const{x}{v}^{-}[z] = \{ u \in x \mid v \in z \}$.
      We have $v \in z$.
      Thus $\const{x}{v}^{-}[z] = x$.
    \end{proof}

    \begin{proposition}[SF 02 02 483725]
      Let $v$ be an element and $z$ be a set that does not contain $v$.
      Then $\const{x}{v}^{-}[z] = \emptyset$.
    \end{proposition}
    \begin{proof}
      $\const{x}{v}^{-}[z] = \{ u \in x \mid \const{x}{v}(u) \in z \}$.
      $\const{x}{v}(u) = v$ for every $u \in x$.
      Hence $\const{x}{v}^{-}[z] = \{ u \in x \mid v \in z \}$.
      It is wrong that $v \in z$.
      Thus $\const{x}{v}^{-}[z] = \emptyset$.
    \end{proof}
  \end{forthel}


  \subsection{Computation rules}

  \begin{forthel}
    \begin{proposition}[SF 02 02 206888]
      Let $f$ be a function from $x$ to $y$ and $a \subseteq x$ and $u \in x$.
      Then $u \in a \implies f(u) \in f[a]$.
    \end{proposition}
    \begin{proof}
      Assume $u \in a$.
      We have $f[a] = \{ f(u') \mid u' \in a \}$.
      Hence $f(u) \in f[a]$.
    \end{proof}

    \begin{proposition}[SF 02 02 451910]
      Let $f$ be a function from $x$ to $y$ and $b \subseteq y$ and $u \in x$.
      Then $f(u) \in b \iff u \in f^{-}[b]$.
    \end{proposition}
    \begin{proof}
      We have $f^{-}[b] = \{ u' \in x \mid f(u') \in b \}$.
      Hence $u \in f^{-}[b]$ iff $u \in x$ and $f(u) \in b$.
      Then we have the thesis.
    \end{proof}

    \begin{proposition}[SF 02 02 186101]
      Let $f$ be a function from $x$ to $y$.
      Then $f[x] \subseteq y$.
    \end{proposition}
    \begin{proof}
      $f[x] = f[\dom(f)] = \range(f) \subseteq y$.
    \end{proof}

    \begin{proposition}[SF 02 02 104059]
      Let $f$ be a function from $x$ to $y$.
      Then $f^{-}[y] = x$.
    \end{proposition}
    \begin{proof}
      We have $f^{-}[y] = \{ u \in x \mid f(u) \in y \}$.
      $f(u)$ is an element of $y$ for all $u \in x$.
      Hence the thesis.
    \end{proof}

    \begin{proposition}[SF 02 02 481295]
      Let $f$ be a function from $x$ to $y$.
      Then $f[f^{-}[y]] = f[x]$.
    \end{proposition}
    \begin{proof}
      Let us show that $f[f^{-}[y]] \subseteq f[x]$.
        Let $v \in f[f^{-}[y]]$.
        Take $u \in f^{-}[y] \cap x$ such that $v = f(u)$.
        Then $u \in x$.
        Hence $v \in f[x]$.
      End.

      Let us show that $f[x] \subseteq f[f^{-}[y]]$.
        Let $v \in f[x]$.
        Take $u \in x$ such that $v = f(u)$.
        We have $v \in y$.
        Hence $u \in f^{-}[y]$.
        Thus $f(u) \in f[f^{-}[y]]$.
        Indeed $f^{-}[y] \subseteq x$.
        Therefore $v \in f[f^{-}[y]]$.
      End.
    \end{proof}

    \begin{proposition}[SF 02 02 253830]
      Let $f$ be a function from $x$ to $y$.
      Then $f^{-}[f[x]] = x$.
    \end{proposition}
    \begin{proof}
      $f^{-}[f[x]] = \{ u \in x \mid f(u) \in f[x] \}$.
      For all $u \in x$ we have $f(u) \in f[x]$.
      Hence every element of $f^{-}[f[x]]$ is contained in $x$ and every element of $x$ is contained in $f^{-}[f[x]]$.
      Thus $f^{-}[f[x]] = x$.
    \end{proof}

    \begin{proposition}[SF 02 02 163978]
      Let $f$ be a function from $x$ to $y$ and $b \subseteq y$.
      Then $f[f^{-}[b]] = b \cap f[x]$.
    \end{proposition}
    \begin{proof}
      Let us show that $f[f^{-}[b]] \subseteq b \cap f[x]$.
        Let $v \in f[f^{-}[b]]$.
        Take $u \in f^{-}[b]$ such that $v = f(u)$.
        Then $f(u) \in b \cap f[x]$.
        Hence we have $v \in b \cap f[x]$.
      End.

      Let us show that $b \cap f[x] \subseteq f[f^{-}[b]]$.
        Let $v \in b \cap f[x]$.
        Take $u \in x$ such that $v = f(u)$.
        Then $u \in f^{-}[b]$.
        Hence $f(u) \in f[f^{-}[b]]$.
      End.
    \end{proof}

    \begin{corollary}[SF 02 02 422873]
      Let $f$ be a function from $x$ to $y$ and $b \subseteq y$.
      Then $f[f^{-}[b]] \subseteq b$.
    \end{corollary}
    \begin{proof}
      We have $f[f^{-}[b]] = b \cap f[x] \subseteq b$.
      Hence $f[f^{-}[b]] \subseteq b$.
    \end{proof}

    \begin{proposition}[SF 02 02 171121]
      Let $f$ be a function from $x$ to $y$ and $a \subseteq x$.
      Then $f^{-}[f[a]] \supseteq a$.
    \end{proposition}
    \begin{proof}
      Let $u \in a$.
      Then $f(u) \in f[a]$.
      Hence $u \in f^{-}[f[a]]$.
      Indeed $f[a] \subseteq y$.
    \end{proof}

    \begin{proposition}[SF 02 02 693086]
      Let $f$ be a function from $x$ to $y$ and $a \subseteq x$.
      Then $f[a] = \emptyset \iff a = \emptyset$.
    \end{proposition}
    \begin{proof}
      Case $f[a] = \emptyset$.
        Then there is no $u \in a$ such that $f(u) \in f[a]$.
        For all $u \in a$ we have $f(u) \in f[a]$.
        Hence $a$ is empty.
      End.

      Case $a = \emptyset$.
        For all $v \in f[a]$ we have $v = f(u)$ for some $u \in a$.
        There is no $u \in a$.
        Hence $f[a]$ is empty.
      End.
    \end{proof}

    \begin{proposition}[SF 02 02 464503]
      Let $f$ be a function from $x$ to $y$ and $b \subseteq y$.
      Then $f^{-}[b] = \emptyset \iff b \subseteq y \setminus f[x]$.
    \end{proposition}
    \begin{proof}
      Case $f^{-}[b] = \emptyset$.
        Let $v \in b$.
        Then $v \in y$.

        There is no $u \in x$ such that $v = f(u)$. \\
        Proof.
          Assume the contrary.
          Take $u \in x$ such that $v = f(u)$.
          Then $u \in f^{-}[b]$.
          Contradiction.
        Qed.

        Hence $v \notin f[x]$.
        Therefore $v \in y \setminus f[x]$.
      End.

      Case $b \subseteq y \setminus f[x]$.
        Then no element of $b$ is an element of $f[x]$.
        Assume that $f^{-}[b]$ is nonempty.
        Take $u \in f^{-}[b]$.
        Then $f(u) \in b$ and $f(u) \in f[x]$.
        Contradiction.
      End.
    \end{proof}

    \begin{proposition}[SF 02 02 474184]
      Let $f$ be a function from $x$ to $y$ and $a \subseteq x$ and $b \subseteq y$.
      Then $f[a] \cap b = \emptyset \iff a \cap f^{-}[b] = \emptyset$.
    \end{proposition}
    \begin{proof}
      Case $f[a] \cap b = \emptyset$.
        Assume that $a \cap f^{-}[b]$ is nonempty.
        Take $u \in a \cap f^{-}[b]$.
        Then $f(u) \in f[a]$ and $f(u) \in b$.
        Hence $f(u) \in f[a] \cap b$.
        Contradiction.
      End.

      Case $a \cap f^{-}[b] = \emptyset$.
        Assume that $f[a] \cap b$ is nonempty.
        Take $v \in f[a] \cap b$.
        Consider a $u \in a$ such that $v = f(u)$.
        Then $u \in f^{-}[b]$.
        Indeed $v \in b$.
        Hence $u \in a \cap f^{-}[b]$.
        Contradiction.
      End.
    \end{proof}

    \begin{proposition}[SF 02 02 522811]
      Let $f$ be a function from $x$ to $y$ and $g$ be a function from $y$ to $z$ and $a \subseteq x$.
      Then $(g \circ f)[a] = g[f[a]]$.
    \end{proposition}
    \begin{proof}
      % We cannot omit the parentheses on the LHS due to a bug in Naproche's parser:
      $((g \circ f)[a]) = \{ g(f(u)) \mid u \in a \}$.
      We have $g[f[a]] = \{ g(v) \mid v \in f[a] \}$ and $f[a] = \{ f(u) \mid u \in a \}$.
      Thus $g[f[a]] = \{ g(f(u)) \mid u \in a \}$.
      Therefore $(g \circ f)[a] = g[f[a]]$.
    \end{proof}

    \begin{proposition}[SF 02 02 819065]
      Let $f$ be a function from $x$ to $y$ and $g$ be a function from $y$ to $z$ and $c \subseteq z$.
      Then $(g \circ f)^{-}[z] = f^{-}[g^{-}[z]]$.
    \end{proposition}
    \begin{proof}
      % Again we need parentheses on the LHS:
      $((g \circ f)^{-}[z]) = \{ u \in x \mid g(f(u)) \in z \}$.
      We have $g^{-}[z] = \{ v \in y \mid g(v) \in z \}$ and $f^{-}[g^{-}[z]] = \{ u \in x \mid f(u) \in g^{-}[z] \}$.
      Hence $f^{-}[g^{-}[z]] = \{ u \in x \mid g(f(u)) \in z \}$.
      Thus $(g \circ f)^{-}[z] = f^{-}[g^{-}[z]]$.
    \end{proof}

    \begin{proposition}[SF 02 02 889945]
      Let $f$ be a function from $x$ to $y$ and $a,a' \subseteq x$.
      Then $a \subseteq a' \implies f[a] \subseteq f[a']$.
    \end{proposition}
    \begin{proof}
      Assume $a \subseteq a'$.
      Let $v \in f[a]$.
      Take $u \in a$ such that $f(u) = v$.
      Then $u \in a'$.
      Hence $v = f(u) \in f[a']$.
    \end{proof}

    \begin{proposition}[SF 02 02 514409]
      Let $f$ be a function from $x$ to $y$ and $b,b' \subseteq y$.
      Then $b \subseteq b' \implies f^{-}[b] \subseteq f^{-}[b']$.
    \end{proposition}
    \begin{proof}
      Assume $b \subseteq b'$.
      Let $u \in f^{-}[b]$.
      Then $f(u) \in b$.
      Hence $f(u) \in b'$.
      Thus $u \in f^{-}[b']$.
    \end{proof}

    \begin{proposition}[SF 02 02 319894]
      Let $f$ be a function from $x$ to $y$ and $a,a' \subseteq x$.
      Then $f[a \cup a'] = f[a] \cup f[a']$.
    \end{proposition}
    \begin{proof}
      Let us show that $f[a \cup a'] \subseteq f[a] \cup f[a']$.
        Let $v \in f[a \cup a']$.
        Take $u \in a \cup a'$ such that $v = f(u)$.
        Then $u \in a$ or $u \in a'$.
        Hence $f(u) \in f[a]$ or $f(u) \in f[a']$.
        Thus $v = f(u) \in f[a] \cup f[a']$.
      End.

      Let us show that $f[a] \cup f[a'] \subseteq f[a \cup a']$.
        Let $v \in f[a] \cup f[a']$.

        Case $v \in f[a]$.
          Take $u \in a$ such that $v = f(u)$.
          Then $u \in a \cup a'$.
          Hence $v \in f[a \cup a']$.
        End.

        Case $v \in f[a']$.
          Take $u \in a'$ such that $v = f(u)$.
          Then $u \in a \cup a'$.
          Hence $v \in f[a \cup a']$.
        End.
      End.
    \end{proof}

    \begin{proposition}[SF 02 02 357044]
      Let $f$ be a function from $x$ to $y$ and $b,b' \subseteq y$.
      Then $f^{-}[b \cup b'] = f^{-}[b] \cup f^{-}[b']$.
    \end{proposition}
    \begin{proof}
      Let us show that $f^{-}[b \cup b'] \subseteq f^{-}[b] \cup f^{-}[b']$.
        Let $u \in f^{-}[b \cup b']$.
        Then $f(u) \in b \cup b'$.
        Hence $f(u) \in b$ or $f(u) \in b'$.
        If $f(u) \in b$ then $u \in f^{-}[b]$.
        If $f(u) \in b'$ then $u \in f^{-}[b']$.
        Thus $u \in f^{-}[b] \cup f^{-}[b']$.
      End.

      Let us show that $f^{-}[b] \cup f^{-}[b'] \subseteq f^{-}[b \cup b']$.
        Let $u \in f^{-}[b] \cup f^{-}[b']$.
        Then $u \in f^{-}[b]$ or $u \in f^{-}[b']$.
        If $u \in f^{-}[b]$ then $f(u) \in b$.
        If $u \in f^{-}[b']$ then $f(u) \in b'$.
        Hence $f(u) \in b \cup b'$.
        Thus $u \in f^{-}[b \cup b']$.
      End.
    \end{proof}

    \begin{proposition}[SF 02 02 512404]
      Let $f$ be a function from $x$ to $y$ and $a,a' \subseteq x$.
      Then $f[a \cap a'] \subseteq f[a] \cap f[a']$.
    \end{proposition}
    \begin{proof}
      Let $v \in f[a \cap a']$.
      Take $u \in a \cap a'$ such that $v = f(u)$.
      Then $u \in a$ and $u \in a'$.
      Hence $f(u) \in f[a]$ and $f(u) \in f[a']$.
      Thus $v \in f[a] \cap f[a]$.
    \end{proof}

    \begin{proposition}[SF 02 02 266480]
      Let $f$ be a function from $x$ to $y$ and $b,b' \subseteq y$.
      Then $f^{-}[b \cap b'] = f^{-}[b] \cap f^{-}[b']$.
    \end{proposition}
    \begin{proof}
      Let us show that $f^{-}[b \cap b'] \subseteq f^{-}[b] \cap f^{-}[b']$.
        Let $u \in f^{-}[b \cap b']$.
        Then $f(u) \in b \cap b'$.
        Hence $f(u) \in b$ and $f(u) \in b'$.
        Thus $u \in f^{-}[b]$ and $u \in f^{-}[b']$.
        Therefore $u \in f^{-}[b] \cap f^{-}[b']$.
      End.

      Let us show that $f^{-}[b] \cap f^{-}[b'] \subseteq f^{-}[b \cap b']$.
        Let $u \in f^{-}[b] \cap f^{-}[b']$.
        Then $u \in f^{-}[b]$ and $u \in f^{-}[b']$.
        Hence $f(u) \in b$ and $f(u) \in b'$.
        Thus $f(u) \in b \cap b'$.
        Therefore $u \in f^{-}[b \cap b']$.
      End.
    \end{proof}

    \begin{proposition}[SF 02 02 560446]
      Let $f$ be a function from $x$ to $y$ and $a,a' \subseteq x$.
      Then $f[a \setminus a'] \supseteq f[a] \setminus f[a']$.
    \end{proposition}
    \begin{proof}
      Let $v \in f[a] \setminus f[a']$.
      Then $v \in f[a]$ and $v \notin f[a']$.
      Take $u \in a$ such that $v = f(u)$.
      If $u \in a'$ then $v \in f[a']$.
      Hence $u \notin a'$.
      Thus $u \in a \setminus a'$.
      Therefore $v = f(u) \in f[a \setminus a']$.
    \end{proof}

    \begin{proposition}[SF 02 02 523450]
      Let $f$ be a function from $x$ to $y$ and $b,b' \subseteq y$.
      Then $f^{-}[b \setminus b'] = f^{-}[b] \setminus f^{-}[b']$.
    \end{proposition}
    \begin{proof}
      Let us show that $f^{-}[b \setminus b'] \subseteq f^{-}[b] \setminus f^{-}[b']$.
        Let $u \in f^{-}[b \setminus b']$.
        Then $f(u) \in b \setminus b'$.
        Hence $f(u) \in b$ and $f(u) \notin b'$.
        Thus $u \in f^{-}[b]$ and $u \notin f^{-}[b']$.
        Therefore $u \in f^{-}[b] \setminus f^{-}[b']$.
      End.

      Let us show that $f^{-}[b] \setminus f^{-}[b'] \subseteq f^{-}[b \setminus b']$.
        Let $u \in f^{-}[b] \setminus f^{-}[b']$.
        Then $u \in f^{-}[b]$ and $u \notin f^{-}[b']$.
        Hence $f(u) \in b$ and $f(u) \notin b'$.
        Thus $f(u) \in b \setminus b'$.
        Therefore $u \in f^{-}[b \setminus b']$.
      End.
    \end{proof}
  \end{forthel}
\end{document}
